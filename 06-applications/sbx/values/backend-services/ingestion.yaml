image:
  tag: "2025.44.1"
  repository: 696630818863.dkr.ecr.eu-central-2.amazonaws.com/uniquecr/backend-service-ingestion
env:
  ELASTICSEARCH_CA_BUNDLE: /etc/ssl/elastic/ca.crt
  ELASTICSEARCH_URL: https://elasticsearch-ingestion-es-http.unique.svc:9200
  ELASTICSEARCH_USERNAME: elastic
  FEATURE_FLAG_ENABLE_ELASTICSEARCH_INDEXING: "true"
  FEATURE_FLAG_ENABLE_SEARCH_ADAPTER_ELASTICSEARCH_UN_9883: "true"
  INGESTION_UPLOAD_API_URL: https://api.hello.azure.unique.dev/scoped/ingestion/upload
  ZITADEL_ROOT_ORG_ID: "305511794535891578"
envVars:
  - name: RABBITMQ_USERNAME
    valueFrom:
      secretKeyRef:
        name: rabbitmqcluster-chat-default-user
        key: username
  - name: AMQP_USERNAME
    valueFrom:
      secretKeyRef:
        name: rabbitmqcluster-chat-default-user
        key: username
  - name: RABBITMQ_PASSWORD
    valueFrom:
      secretKeyRef:
        name: rabbitmqcluster-chat-default-user
        key: password
  - name: AMQP_PASSWORD
    valueFrom:
      secretKeyRef:
        name: rabbitmqcluster-chat-default-user
        key: password
  - name: AMQP_HOST
    valueFrom:
      secretKeyRef:
        name: rabbitmqcluster-chat-default-user
        key: host
  - name: AMQP_PORT
    valueFrom:
      secretKeyRef:
        name: rabbitmqcluster-chat-default-user
        key: port
  - name: ELASTICSEARCH_PASSWORD
    valueFrom:
      secretKeyRef:
        name: elasticsearch-ingestion-es-elastic-user
        key: elastic
replicaCount: 2
resources:
  limits:
    cpu: 200m
    memory: 700Mi
  requests:
    cpu: 200m
    memory: 650Mi
serviceAccount:
  enabled: true
  # IRSA: IAM role needs to be created in 05-compute/terraform/iam.tf if AWS access is required
  # irsa:
  #   roleArn: "arn:aws:iam::696630818863:role/acme-dogfood-sbx-euc2-ingestion"
  #   enabled: true
secretProvider:
  vaults:
    helloazuresensitive:
      DATABASE_URL: database-url-ingestion
      AZURE_FGPT_STORAGE_CONNECTION_STRING: ingestion-storage-connection-string-1
      AZURE_INGESTION_CACHE_STORAGE_CONNECTION_STRING: ingestion-cache-connection-string-1
      INGESTION_ENCRYPTION_KEY: encryption-key-ingestion
    helloazuremain:
      AZURE_OPENAI_API_ENDPOINT: cognitive-account-swedencentral-ep
      AZURE_DOCUMENT_INTELLIGENCE_ENDPOINTS: azure-document-intelligence-endpoints
volumeMounts:
  - name: elastic-certs
    mountPath: /etc/ssl/elastic/ca.crt
    readOnly: true
    subPath: ca.crt
volumes:
  - name: elastic-certs
    secret:
      secretName: elasticsearch-ingestion-es-http-certs-public
