# Using public images for sbx - private ECR not accessible
controller:
  image:
    repository: kong/kubernetes-ingress-controller
    tag: 3.4.4
  ingressController:
    envFrom:
      - configMapRef:
          name: kong-controller-environment
  proxy:
    type: ClusterIP
  # nodeSelector removed for sbx - nodes don't have these labels
  # nodeSelector:
  #   scalability: steady
  #   lifecycle: persistent
  deploymentAnnotations:
    configmap.reloader.stakater.com/reload: "kong-controller-environment"
  extraObjects:
    - apiVersion: v1
      kind: ConfigMap
      metadata:
        name: kong-controller-environment
      data:
        CONTROLLER_LOG_LEVEL: info
        CONTROLLER_PROXY_SYNC_SECONDS: "15"
    - apiVersion: gateway.networking.k8s.io/v1
      kind: GatewayClass
      metadata:
        name: kong
        annotations:
          konghq.com/gatewayclass-unmanaged: "true"
      spec:
        controllerName: konghq.com/kic-gateway-controller
gateway:
  image:
    repository: kong
    tag: 3.9.0
  # nodeSelector removed for sbx - nodes don't have these labels
  # nodeSelector:
  #   scalability: steady
  #   lifecycle: persistent
  proxy:
    type: ClusterIP
    tls:
      appProtocol: "https"
  plugins:
    configMaps:
      - name: kong-plugin-unique-jwt-auth
        pluginName: unique-jwt-auth
      - name: kong-plugin-unique-app-repo-auth
        pluginName: unique-app-repo-auth
  deploymentAnnotations:
    configmap.reloader.stakater.com/reload: "kong-gateway-environment,kong-plugin-unique-jwt-auth,kong-plugin-unique-app-repo-auth"
  envFrom:
    - configMapRef:
        name: kong-gateway-environment
  status:
    tls:
      enabled: true
  certificates:
    enabled: true
    clusterIssuer: letsencrypt-route53-dns
    proxy:
      enabled: true
      clusterIssuer: letsencrypt-route53-dns
      commonName: <DOMAIN_BASE>
      dnsNames:
        - <DOMAIN_BASE>
        - <DOMAIN_API>
        - <DOMAIN_IDENTITY>
    admin:
      enabled: false
    cluster:
      enabled: false
    portal:
      enabled: false
  extraObjects:
    - apiVersion: elbv2.k8s.aws/v1beta1
      kind: TargetGroupBinding
      metadata:
        name: kong-proxy-http
      spec:
        serviceRef:
          name: kong-gateway-proxy
          port: 80
        targetGroupARN: <TARGET_GROUP_HTTP_ARN>
        targetType: ip
    - apiVersion: elbv2.k8s.aws/v1beta1
      kind: TargetGroupBinding
      metadata:
        name: kong-proxy-https
      spec:
        serviceRef:
          name: kong-gateway-proxy
          port: 443
        targetGroupARN: <TARGET_GROUP_HTTPS_ARN>
        targetType: ip
